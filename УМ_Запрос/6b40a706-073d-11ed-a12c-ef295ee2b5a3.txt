{
 'Реквизиты': {
  'Наименование': 'Контроль - заполнение пользователей',
  'ТекстОбработки': '//------------------------------------------------------------------------------
	//ПАРАМЕТРЫ                                          
	//------------------------------------------------------------------------------
	Отладка = Ложь;   
	 
	ДатаНачалаВыгрузки = ТекущаяДата();
	ТемаСообщения = ""+Система+" - Неправильно заведенные пользователи 1С "+Формат(ДатаНачалаВыгрузки,"ДФ=dd.MM.yyyy");  
	
	ПочтаПолучателей = "group1c@t-medica.com";   
	 
	ГуидУчетнойЗаписиПочты = "567e3146-123f-11ed-a12c-ef295ee2b5a3"; //предопределенная
	 
    Если Отладка Тогда 
    	ПочтаПолучателей = "ssmirnov@t-medica.com";
    КонецЕсли;
	
	СимволПереносаСтроки = Символы.ПС + Символы.ВК;
	СимволПереносаСтроки = Символы.ПС;  
	
	ТекстСообщения = "Выполняются проверки:"+СимволПереносаСтроки+
	"	* Пустой пароль 1С - у всех активных пользователей"+СимволПереносаСтроки+
	"	* Пустой email - у всех активных не служебных пользователей"+СимволПереносаСтроки+
	//"	* Не равно имя и полное имя пользователя - у всех активных не служебных пользователей"+СимволПереносаСтроки+
	"	* ФИО должно состоять из 3 слов - у всех активных не служебных пользователей"+СимволПереносаСтроки+
	"	* Не должно быть прав администратора - у всех активных, не служебных и не администраторов 1С "+СимволПереносаСтроки+ 
	"	* Служебный пользователь не должен быть показан в списке выбора - у всех активныхпользователей"+СимволПереносаСтроки+СимволПереносаСтроки+	
	"ПользовательАдминистратор1С и СлужебныйПользователь - дополнительные реквизиты или папки ""Администраторы"" и ""Служебные"" (в зависимости от системы) "+СимволПереносаСтроки+
	СимволПереносаСтроки;
	
	//------------------------------------------------------------------------------
	//Запрос в базу
	//------------------------------------------------------------------------------ 
	Код1СДляИсистемы = ПолучитьЗначениеПеременной(Переменные,"Код1СДляСистемы",Система);
	Если Код1СДляИсистемы = Неопределено Тогда 		
		Код1СДляИсистемы = ПолучитьЗначениеПеременной(Переменные,"Код1СДляСистемы"); //общее
	КонецЕсли;
	
	СтруктураЗапроса = Новый Структура("value",Код1СДляИсистемы);	
		
	ЗаписьJSON = Новый ЗаписьJSON;	
	ЗаписьJSON.УстановитьСтроку();
	ЗаписатьJSON(ЗаписьJSON, СтруктураЗапроса);			
	СтрокаТелаЗапроса = ЗаписьJSON.Закрыть();
		
        
	HTTPЗапрос = Новый HTTPЗапрос(Соединение.АдресЗапроса);     
	HTTPЗапрос.УстановитьТелоИзСтроки(СтрокаТелаЗапроса);
	HTTPОтвет = Соединение.HTTPСоединение.ВызватьHTTPМетод("POST", HTTPЗапрос); 
	
	РезультатРазбораHTTP = Алгоритм("ПрочитатьОтветСервисаUniversal",HTTPОтвет); 
	Если не РезультатРазбораHTTP.Успешно Тогда 
		ВызватьИсключение РезультатРазбораHTTP.Результат;
	КонецЕсли;
 	   
	//Отправка письма
	Если ЗначениеЗаполнено(РезультатРазбораHTTP.Результат) Тогда
		ТекстСообщения = ТекстСообщения + РезультатРазбораHTTP.Результат;
		Алгоритм("ОтправитьEmail",ЗапросСсылка,ПочтаПолучателей,ТемаСообщения,ТекстСообщения,ТипТекстаПочтовогоСообщения.ПростойТекст,ГуидУчетнойЗаписиПочты); 
		СтрокаОшибок = СтрокаОшибок + ""+Система+" - сообщения отправлены"+Символы.ПС;
	Иначе
		СтрокаОшибок = СтрокаОшибок + ""+Система+" - нет данных для отправки"+Символы.ПС;
	КонецЕсли;	
	
	Если не Отладка Тогда
		УстановитьДатуПоследнейВыгрузки(Система,ЗапросСсылка,ДатаНачалаВыгрузки);
	КонецЕсли;',
  'Комментарий': ''
 },
 'ТЧ': [
  {
   'Переменные': [
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': null,
     'ЗначениеСтрока': '    Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("АдминистраторСистемы"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Администрирование"));
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        НовСтрТЗ.АдресЭлектроннойПочты = ПользовательИБ.АдресЭлектроннойПочты;
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ТЗПользователейИБ.Имя КАК Имя,
        |   ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        |   ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |   ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |   ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |   &ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТПользователиИБ.Имя КАК Имя,
        |   ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |   Пользователи.Ссылка КАК ПользовательСсылка,
        |   МАКСИМУМ(ЕСТЬNULL(ПользователиКонтактнаяИнформация.АдресЭП, """")) КАК Email,
        |   Пользователи.Служебный КАК Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПользователиДР_Администратор1С.Значение КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПользователиДР_Служебный.Значение КАК БУЛЕВО), ЛОЖЬ)) ИЛИ Пользователи.Служебный КАК ЭтоСлужебный,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |   ВТПользователиИБ КАК ВТПользователиИБ
        |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |           ПО Пользователи.Ссылка = ПользователиКонтактнаяИнформация.Ссылка
        |               И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
        |               И (ПользователиКонтактнаяИнформация.АдресЭП <> """")
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.ДополнительныеРеквизиты КАК ПользователиДР_Администратор1С
        |           ПО Пользователи.Ссылка = ПользователиДР_Администратор1С.Ссылка
        |               И (ПользователиДР_Администратор1С.Свойство = &СвойствоПользовательАдминистратор1С)
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.ДополнительныеРеквизиты КАК ПользователиДР_Служебный
        |           ПО Пользователи.Ссылка = ПользователиДР_Служебный.Ссылка
        |               И (ПользователиДР_Служебный.Свойство = &СвойствоСлужебныйПользователь)
        |       ПО ВТПользователиИБ.УникальныйИдентификатор = Пользователи.ИдентификаторПользователяИБ
        |ГДЕ
        |   НЕ Пользователи.Недействителен
        |   И (ВТПользователиИБ.АутентификацияСтандартная
        |           ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |           ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |   ВТПользователиИБ.Имя,
        |   ВТПользователиИБ.ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС,
        |   Пользователи.Ссылка,
        |   Пользователи.Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя КАК Имя,
        |   ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |   ""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.АутентификацияСтандартная
        |   И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Не установлен email""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.Email = """"
        |   И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        //|ОБЪЕДИНИТЬ ВСЕ
        //|
        //|ВЫБРАТЬ
        //|   ВТАктивныеПользователи.Имя,
        //|   ВТАктивныеПользователи.ПолноеИмя,
        //|   ВТАктивныеПользователи.ПользовательСсылка,
        //|   ""Имя пользователя отличается от имени пользователя ИБ""
        //|ИЗ
        //|   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        //|ГДЕ
        //|   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        //|   И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
        //|
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |   И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |   ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);
    Запрос.УстановитьПараметр("СвойствоПользовательАдминистратор1С",ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоРеквизиту("Имя","ПользовательАдминистратор1С"));    
    Запрос.УстановитьПараметр("СвойствоСлужебныйПользователь",ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоРеквизиту("Имя","СлужебныйПользователь"));    

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': 'общее'
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a1389a1477d34aa711ed64de66f52e6d',
     'ЗначениеСтрока': '    Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        НовСтрТЗ.АдресЭлектроннойПочты = ПользовательИБ.АдресЭлектроннойПочты;
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
		|	ТЗПользователейИБ.Имя КАК Имя,
		|	ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
		|	ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
		|	ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
		|	ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
		|	ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
		|	ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
		|	ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
		|	ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
		|	ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
		|	ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
		|ПОМЕСТИТЬ ВТПользователиИБ
		|ИЗ
		|	&ТЗПользователейИБ КАК ТЗПользователейИБ
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	Вложенный.Папка КАК Папка,
		|	МАКСИМУМ(Вложенный.Служебный) КАК Служебный,
		|	МАКСИМУМ(Вложенный.Администратор) КАК Администратор
		|ПОМЕСТИТЬ ВТПапкиСвойствПользователей
		|ИЗ
		|	(ВЫБРАТЬ
		|		Пользователи.Ссылка КАК Папка,
		|		ЛОЖЬ КАК Служебный,
		|		ИСТИНА КАК Администратор
		|	ИЗ
		|		Справочник.Пользователи КАК Пользователи
		|	ГДЕ
		|		Пользователи.ЭтоГруппа
		|		И Пользователи.Наименование = ""Администраторы""
		|	
		|	ОБЪЕДИНИТЬ ВСЕ
		|	
		|	ВЫБРАТЬ
		|		Пользователи.Ссылка,
		|		ИСТИНА,
		|		ЛОЖЬ
		|	ИЗ
		|		Справочник.Пользователи КАК Пользователи
		|	ГДЕ
		|		Пользователи.ЭтоГруппа
		|		И Пользователи.Наименование = ""Служебные"") КАК Вложенный
		|
		|СГРУППИРОВАТЬ ПО
		|	Вложенный.Папка
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТПользователиИБ.Имя КАК Имя,
		|	ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
		|	ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
		|	ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
		|	ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
		|	ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
		|	ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
		|	ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
		|	Пользователи.Ссылка КАК ПользовательСсылка,
		|	МАКСИМУМ(ЕСТЬNULL(ПользователиКонтактнаяИнформация.Представление, """")) КАК Email,
		|	МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК Служебный,
		|	ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
		|	ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
		|	МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Администратор КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
		|	МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоСлужебный,
		|	ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
		|ПОМЕСТИТЬ ВТАктивныеПользователи
		|ИЗ
		|	ВТПользователиИБ КАК ВТПользователиИБ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
		|			ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
		|			ПО (Пользователи.Ссылка = (ВЫРАЗИТЬ(ПользователиКонтактнаяИнформация.Объект КАК Справочник.Пользователи)))
		|				И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
		|				И (ПользователиКонтактнаяИнформация.Представление <> """")
		|			ЛЕВОЕ СОЕДИНЕНИЕ ВТПапкиСвойствПользователей КАК ВТПапкиСвойствПользователей
		|			ПО Пользователи.Родитель = ВТПапкиСвойствПользователей.Папка
		|		ПО ВТПользователиИБ.Имя = Пользователи.Код
		|ГДЕ
		|	НЕ Пользователи.ПометкаУдаления
		|	И (ВТПользователиИБ.АутентификацияСтандартная
		|			ИЛИ ВТПользователиИБ.АутентификацияOpenID
		|			ИЛИ ВТПользователиИБ.АутентификацияОС)
		|
		|СГРУППИРОВАТЬ ПО
		|	ВТПользователиИБ.Имя,
		|	ВТПользователиИБ.ПолноеИмя,
		|	ВТПользователиИБ.УникальныйИдентификатор,
		|	ВТПользователиИБ.АдресЭлектроннойПочты,
		|	ВТПользователиИБ.АутентификацияСтандартная,
		|	ВТПользователиИБ.ПарольУстановлен,
		|	ВТПользователиИБ.АутентификацияOpenID,
		|	ВТПользователиИБ.АутентификацияОС,
		|	Пользователи.Ссылка,
		|	ВТПользователиИБ.КолвоСловВИмени,
		|	ВТПользователиИБ.ЕстьПраваАдминистратора,
		|	ВТПользователиИБ.ПоказыватьВСпискеВыбора
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ВТАктивныеПользователи.Имя КАК Имя,
		|	ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
		|	ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
		|	""Пустой пароль 1С"" КАК Нарушение
		|ИЗ
		|	ВТАктивныеПользователи КАК ВТАктивныеПользователи
		|ГДЕ
		|	ВТАктивныеПользователи.АутентификацияСтандартная
		|	И НЕ ВТАктивныеПользователи.ПарольУстановлен
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТАктивныеПользователи.Имя,
		|	ВТАктивныеПользователи.ПолноеИмя,
		|	ВТАктивныеПользователи.ПользовательСсылка,
		|	""Не установлен email""
		|ИЗ
		|	ВТАктивныеПользователи КАК ВТАктивныеПользователи
		|ГДЕ
		|	ВТАктивныеПользователи.Email = """"
		|	И НЕ ВТАктивныеПользователи.ЭтоСлужебный
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТАктивныеПользователи.Имя,
		|	ВТАктивныеПользователи.ПолноеИмя,
		|	ВТАктивныеПользователи.ПользовательСсылка,
		|	""Имя пользователя отличается от имени пользователя ИБ""
		|ИЗ
		|	ВТАктивныеПользователи КАК ВТАктивныеПользователи
		|ГДЕ
		|	НЕ ВТАктивныеПользователи.ЭтоСлужебный
		|	И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТАктивныеПользователи.Имя,
		|	ВТАктивныеПользователи.ПолноеИмя,
		|	ВТАктивныеПользователи.ПользовательСсылка,
		|	""Имя должно состоять из 3 слов: ФИО""
		|ИЗ
		|	ВТАктивныеПользователи КАК ВТАктивныеПользователи
		|ГДЕ
		|	НЕ ВТАктивныеПользователи.ЭтоСлужебный
		|	И ВТАктивныеПользователи.КолвоСловВИмени <> 3
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТАктивныеПользователи.Имя,
		|	ВТАктивныеПользователи.ПолноеИмя,
		|	ВТАктивныеПользователи.ПользовательСсылка,
		|	""Пользователь (не администратор 1С) имеет админские права""
		|ИЗ
		|	ВТАктивныеПользователи КАК ВТАктивныеПользователи
		|ГДЕ
		|	НЕ ВТАктивныеПользователи.ЭтоСлужебный
		|	И ВТАктивныеПользователи.ЕстьПраваАдминистратора
		|	И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ВТАктивныеПользователи.Имя,
		|	ВТАктивныеПользователи.ПолноеИмя,
		|	ВТАктивныеПользователи.ПользовательСсылка,
		|	""Слежубный пользователь не должен быть показан в списке выбора""
		|ИЗ
		|	ВТАктивныеПользователи КАК ВТАктивныеПользователи
		|ГДЕ
		|	ВТАктивныеПользователи.ЭтоСлужебный
		|	И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
		|
		|УПОРЯДОЧИТЬ ПО
		|	ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': ''
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a14287575112374c11ede342c76fecdd',
     'ЗначениеСтрока': 'Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Глн_Администратор"));
	МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Инт_Администратор"));
	МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПравоАдминистрирования"));
	//МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("УБИ_ПолныеПрава"));
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        НовСтрТЗ.АдресЭлектроннойПочты = ПользовательИБ.АдресЭлектроннойПочты;
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ТЗПользователейИБ.Имя КАК Имя,
        |   ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        |   ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |   ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |   ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |   &ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   Вложенный.Папка КАК Папка,
        |   МАКСИМУМ(Вложенный.Служебный) КАК Служебный,
        |   МАКСИМУМ(Вложенный.Администратор) КАК Администратор
        |ПОМЕСТИТЬ ВТПапкиСвойствПользователей
        |ИЗ
        |   (ВЫБРАТЬ
        |       Пользователи.Ссылка КАК Папка,
        |       ЛОЖЬ КАК Служебный,
        |       ИСТИНА КАК Администратор
        |   ИЗ
        |       Справочник.Пользователи КАК Пользователи
        |   ГДЕ
        |       Пользователи.ЭтоГруппа
        |       И Пользователи.Наименование = ""Администраторы""
        |   
        |   ОБЪЕДИНИТЬ ВСЕ
        |   
        |   ВЫБРАТЬ
        |       Пользователи.Ссылка,
        |       ИСТИНА,
        |       ЛОЖЬ
        |   ИЗ
        |       Справочник.Пользователи КАК Пользователи
        |   ГДЕ
        |       Пользователи.ЭтоГруппа
        |       И Пользователи.Наименование = ""Служебные"") КАК Вложенный
        |
        |СГРУППИРОВАТЬ ПО
        |   Вложенный.Папка
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТПользователиИБ.Имя КАК Имя,
        |   ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |   Пользователи.Ссылка КАК ПользовательСсылка,
        |   МАКСИМУМ(ЕСТЬNULL(Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)), """")) КАК Email,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Администратор КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоСлужебный,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |   ВТПользователиИБ КАК ВТПользователиИБ
        |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |           ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |           ПО (Пользователи.Ссылка = (ВЫРАЗИТЬ(ПользователиКонтактнаяИнформация.Объект КАК Справочник.Пользователи)))
        |               И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
        |               И (Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)) <> """")
        |           ЛЕВОЕ СОЕДИНЕНИЕ ВТПапкиСвойствПользователей КАК ВТПапкиСвойствПользователей
        |           ПО Пользователи.Родитель = ВТПапкиСвойствПользователей.Папка
        |       ПО ВТПользователиИБ.Имя = Пользователи.Код
        |ГДЕ
        |   НЕ Пользователи.ПометкаУдаления
        |   И (ВТПользователиИБ.АутентификацияСтандартная
        |           ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |           ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |   ВТПользователиИБ.Имя,
        |   ВТПользователиИБ.ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС,
        |   Пользователи.Ссылка,
        |   ВТПользователиИБ.КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя КАК Имя,
        |   ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |   ""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.АутентификацияСтандартная
        |   И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Не установлен email""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.Email = """"
        |   И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        //|ОБЪЕДИНИТЬ ВСЕ
        //|
        //|ВЫБРАТЬ
        //|   ВТАктивныеПользователи.Имя,
        //|   ВТАктивныеПользователи.ПолноеИмя,
        //|   ВТАктивныеПользователи.ПользовательСсылка,
        //|   ""Имя пользователя отличается от имени пользователя ИБ""
        //|ИЗ
        //|   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        //|ГДЕ
        //|   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        //|   И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
        //|
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |   И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |   ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': ''
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a14287575112374c11ede40e8bb9e0ed',
     'ЗначениеСтрока': 'Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Глн_Администратор"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Инт_Администратор"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПравоАдминистрирования"));
    //МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("УБИ_ПолныеПрава"));
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        НовСтрТЗ.АдресЭлектроннойПочты = ПользовательИБ.АдресЭлектроннойПочты;
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ТЗПользователейИБ.Имя КАК Имя,
        |   ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        |   ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |   ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |   ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |   &ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   Вложенный.Папка КАК Папка,
        |   МАКСИМУМ(Вложенный.Служебный) КАК Служебный,
        |   МАКСИМУМ(Вложенный.Администратор) КАК Администратор
        |ПОМЕСТИТЬ ВТПапкиСвойствПользователей
        |ИЗ
        |   (ВЫБРАТЬ
        |       Пользователи.Ссылка КАК Папка,
        |       ЛОЖЬ КАК Служебный,
        |       ИСТИНА КАК Администратор
        |   ИЗ
        |       Справочник.Пользователи КАК Пользователи
        |   ГДЕ
        |       Пользователи.ЭтоГруппа
        |       И Пользователи.Наименование = ""Администраторы""
        |   
        |   ОБЪЕДИНИТЬ ВСЕ
        |   
        |   ВЫБРАТЬ
        |       Пользователи.Ссылка,
        |       ИСТИНА,
        |       ЛОЖЬ
        |   ИЗ
        |       Справочник.Пользователи КАК Пользователи
        |   ГДЕ
        |       Пользователи.ЭтоГруппа
        |       И Пользователи.Наименование = ""Служебные"") КАК Вложенный
        |
        |СГРУППИРОВАТЬ ПО
        |   Вложенный.Папка
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТПользователиИБ.Имя КАК Имя,
        |   ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |   Пользователи.Ссылка КАК ПользовательСсылка,
        |   МАКСИМУМ(ЕСТЬNULL(Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)), """")) КАК Email,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Администратор КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоСлужебный,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |   ВТПользователиИБ КАК ВТПользователиИБ
        |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |           ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |           ПО (Пользователи.Ссылка = (ВЫРАЗИТЬ(ПользователиКонтактнаяИнформация.Объект КАК Справочник.Пользователи)))
        |               И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
        |               И (Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)) <> """")
        |           ЛЕВОЕ СОЕДИНЕНИЕ ВТПапкиСвойствПользователей КАК ВТПапкиСвойствПользователей
        |           ПО Пользователи.Родитель = ВТПапкиСвойствПользователей.Папка
        |       ПО ВТПользователиИБ.Имя = Пользователи.Код
        |ГДЕ
        |   НЕ Пользователи.ПометкаУдаления
        |   И (ВТПользователиИБ.АутентификацияСтандартная
        |           ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |           ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |   ВТПользователиИБ.Имя,
        |   ВТПользователиИБ.ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС,
        |   Пользователи.Ссылка,
        |   ВТПользователиИБ.КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя КАК Имя,
        |   ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |   ""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.АутентификацияСтандартная
        |   И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Не установлен email""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.Email = """"
        |   И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        //|ОБЪЕДИНИТЬ ВСЕ
        //|
        //|ВЫБРАТЬ
        //|   ВТАктивныеПользователи.Имя,
        //|   ВТАктивныеПользователи.ПолноеИмя,
        //|   ВТАктивныеПользователи.ПользовательСсылка,
        //|   ""Имя пользователя отличается от имени пользователя ИБ""
        //|ИЗ
        //|   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        //|ГДЕ
        //|   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        //|   И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
        //|
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |   И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |   ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': ''
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a14587575112374c11edefe38874ea52',
     'ЗначениеСтрока': 'Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("АдминистраторСистемы"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Администрирование"));
	МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("усРазработчик"));
    
    СоответветствиеEmail = Новый Соответствие();
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ПользователиКонтактнаяИнформация.Ссылка.ИдентификаторПользователяИБ,
        |   МАКСИМУМ(ПользователиКонтактнаяИнформация.АдресЭП) КАК АдресЭП
        |ИЗ
        |   Справочник.Пользователи.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |ГДЕ
        |   ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты)
        |   И ПользователиКонтактнаяИнформация.АдресЭП <> """"
        |
        |СГРУППИРОВАТЬ ПО
        |   ПользователиКонтактнаяИнформация.Ссылка.ИдентификаторПользователяИБ";

    РезультатЗапроса = Запрос.Выполнить();  
    Выборка = РезультатЗапроса.Выбрать();
    Пока Выборка.Следующий() Цикл
        СоответветствиеEmail.Вставить(Выборка.ИдентификаторПользователяИБ,Выборка.АдресЭП);
    КонецЦикла;
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        
        Email = СоответветствиеEmail.Получить(ПользовательИБ.УникальныйИдентификатор);
        Если ЗначениеЗаполнено(Email) Тогда
            НовСтрТЗ.АдресЭлектроннойПочты = Email;
        КонецЕсли;
    
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ТЗПользователейИБ.Имя КАК Имя,
        |   ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        //|   ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |   ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |   ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |   &ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   Вложенный.Пользователь КАК Пользователь,
        |   МАКСИМУМ(Вложенный.Служебный) КАК Служебный,
        |   МАКСИМУМ(Вложенный.Администратор) КАК Администратор
        |ПОМЕСТИТЬ ПризнакиПользователей
        |ИЗ
        |   (ВЫБРАТЬ
        |       ГруппыПользователейСостав.Пользователь КАК Пользователь,
        |       ЛОЖЬ КАК Служебный,
        |       ИСТИНА КАК Администратор
        |   ИЗ
        |       Справочник.ГруппыПользователей.Состав КАК ГруппыПользователейСостав
        |   ГДЕ
        |       ГруппыПользователейСостав.Ссылка.Наименование = ""Администраторы""
        |   
        |   ОБЪЕДИНИТЬ ВСЕ
        |   
        |   ВЫБРАТЬ
        |       ГруппыПользователейСостав.Пользователь,
        |       ИСТИНА,
        |       ЛОЖЬ
        |   ИЗ
        |       Справочник.ГруппыПользователей.Состав КАК ГруппыПользователейСостав
        |   ГДЕ
        |       ГруппыПользователейСостав.Ссылка.Наименование = ""Служебные"") КАК Вложенный
        |
        |СГРУППИРОВАТЬ ПО
        |   Вложенный.Пользователь
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТПользователиИБ.Имя КАК Имя,
        |   ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        //|   ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |   Пользователи.Ссылка КАК ПользовательСсылка,
        |   МАКСИМУМ(ЕСТЬNULL(Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)), """")) КАК Email,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПризнакиПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПризнакиПользователей.Администратор КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПризнакиПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоСлужебный,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |   ВТПользователиИБ КАК ВТПользователиИБ
        |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |           ПО (Пользователи.Ссылка = ПользователиКонтактнаяИнформация.Ссылка)
        |               И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
        |               И (Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)) <> """")
        |           ЛЕВОЕ СОЕДИНЕНИЕ ПризнакиПользователей КАК ПризнакиПользователей
        |           ПО Пользователи.Ссылка = ПризнакиПользователей.Пользователь
        |       ПО ВТПользователиИБ.ПолноеИмя = Пользователи.Наименование
        |ГДЕ
        |   НЕ Пользователи.ПометкаУдаления
        |   И (ВТПользователиИБ.АутентификацияСтандартная
        |           ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |           ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |   ВТПользователиИБ.Имя,
        |   ВТПользователиИБ.ПолноеИмя,
        //|   ВТПользователиИБ.УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС,
        |   Пользователи.Ссылка,
        |   ВТПользователиИБ.КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя КАК Имя,
        |   ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |   ""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.АутентификацияСтандартная
        |   И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Не установлен email""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.Email = """"
        |   И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        //|ОБЪЕДИНИТЬ ВСЕ
        //|
        //|ВЫБРАТЬ
        //|   ВТАктивныеПользователи.Имя,
        //|   ВТАктивныеПользователи.ПолноеИмя,
        //|   ВТАктивныеПользователи.ПользовательСсылка,
        //|   ""Имя пользователя отличается от имени пользователя ИБ""
        //|ИЗ
        //|   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        //|ГДЕ
        //|   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        //|   И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
        //|
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |   И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |   ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
        КонецЦикла;',
     'Комментарий': ''
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a14587575112374c11edefe3e05f19e3',
     'ЗначениеСтрока': '    Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("АдминистраторСистемы"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Администрирование"));
	МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("упРазработчик"));
	МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ирРазработчик"));
	МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ирПравоАдминистрирование"));
    
    СоответветствиеEmail = Новый Соответствие();
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ПользователиКонтактнаяИнформация.Ссылка.ИдентификаторПользователяИБ,
        |   МАКСИМУМ(ПользователиКонтактнаяИнформация.АдресЭП) КАК АдресЭП
        |ИЗ
        |   Справочник.Пользователи.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |ГДЕ
        |   ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты)
        |   И ПользователиКонтактнаяИнформация.АдресЭП <> """"
        |
        |СГРУППИРОВАТЬ ПО
        |   ПользователиКонтактнаяИнформация.Ссылка.ИдентификаторПользователяИБ";

    РезультатЗапроса = Запрос.Выполнить();  
    Выборка = РезультатЗапроса.Выбрать();
    Пока Выборка.Следующий() Цикл
        СоответветствиеEmail.Вставить(Выборка.ИдентификаторПользователяИБ,Выборка.АдресЭП);
    КонецЦикла;
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        
        Email = СоответветствиеEmail.Получить(ПользовательИБ.УникальныйИдентификатор);
        Если ЗначениеЗаполнено(Email) Тогда
            НовСтрТЗ.АдресЭлектроннойПочты = Email;
        КонецЕсли;
        
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ТЗПользователейИБ.Имя КАК Имя,
        |   ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        //|   ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |   ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |   ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |   &ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТПользователиИБ.Имя КАК Имя,
        |   ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        //|   ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |   Пользователи.Ссылка КАК ПользовательСсылка,
        |   МАКСИМУМ(ЕСТЬNULL(ПользователиКонтактнаяИнформация.АдресЭП, """")) КАК Email,
        |   Пользователи.Служебный КАК Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПользователиДР_Администратор1С.Значение КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ПользователиДР_Служебный.Значение КАК БУЛЕВО), ЛОЖЬ)) ИЛИ Пользователи.Служебный КАК ЭтоСлужебный,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |   ВТПользователиИБ КАК ВТПользователиИБ
        |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |           ПО Пользователи.Ссылка = ПользователиКонтактнаяИнформация.Ссылка
        |               И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
        |               И (ПользователиКонтактнаяИнформация.АдресЭП <> """")
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.ДополнительныеРеквизиты КАК ПользователиДР_Администратор1С
        |           ПО Пользователи.Ссылка = ПользователиДР_Администратор1С.Ссылка
        |               И (ПользователиДР_Администратор1С.Свойство = &СвойствоПользовательАдминистратор1С)
        |           ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пользователи.ДополнительныеРеквизиты КАК ПользователиДР_Служебный
        |           ПО Пользователи.Ссылка = ПользователиДР_Служебный.Ссылка
        |               И (ПользователиДР_Служебный.Свойство = &СвойствоСлужебныйПользователь)
        |       ПО ВТПользователиИБ.ПолноеИмя = Пользователи.Наименование
        |ГДЕ
        |   НЕ Пользователи.Недействителен
        |   И (ВТПользователиИБ.АутентификацияСтандартная
        |           ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |           ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |   ВТПользователиИБ.Имя,
        |   ВТПользователиИБ.ПолноеИмя,
        //|   ВТПользователиИБ.УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС,
        |   Пользователи.Ссылка,
        |   Пользователи.Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя КАК Имя,
        |   ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |   ""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.АутентификацияСтандартная
        |   И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Не установлен email""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.Email = """"
        |   И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        //|ОБЪЕДИНИТЬ ВСЕ
        //|
        //|ВЫБРАТЬ
        //|   ВТАктивныеПользователи.Имя,
        //|   ВТАктивныеПользователи.ПолноеИмя,
        //|   ВТАктивныеПользователи.ПользовательСсылка,
        //|   ""Имя пользователя отличается от имени пользователя ИБ""
        //|ИЗ
        //|   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        //|ГДЕ
        //|   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        //|   И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
        //|
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |   И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |   ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);
    Запрос.УстановитьПараметр("СвойствоПользовательАдминистратор1С",ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоНаименованию("Администратор 1С (Пользователь)",Истина));    
    Запрос.УстановитьПараметр("СвойствоСлужебныйПользователь",ПланыВидовХарактеристик.ДополнительныеРеквизитыИСведения.НайтиПоНаименованию("Служебный (Пользователь)",Истина));    

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': 'поиск доп свойств по наименованию'
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a14987575112374c11edf979bff7c576',
     'ЗначениеСтрока': 'Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("Гален_ПолныеПрава"));
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        НовСтрТЗ.АдресЭлектроннойПочты = ПользовательИБ.АдресЭлектроннойПочты;
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |   ТЗПользователейИБ.Имя КАК Имя,
        |   ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        |   ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |   ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |   ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |   &ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   Вложенный.Папка КАК Папка,
        |   МАКСИМУМ(Вложенный.Служебный) КАК Служебный,
        |   МАКСИМУМ(Вложенный.Администратор) КАК Администратор
        |ПОМЕСТИТЬ ВТПапкиСвойствПользователей
        |ИЗ
        |   (ВЫБРАТЬ
        |       Пользователи.Ссылка КАК Папка,
        |       ЛОЖЬ КАК Служебный,
        |       ИСТИНА КАК Администратор
        |   ИЗ
        |       Справочник.Пользователи КАК Пользователи
        |   ГДЕ
        |       Пользователи.ЭтоГруппа
        |       И Пользователи.Наименование = ""Администраторы""
        |   
        |   ОБЪЕДИНИТЬ ВСЕ
        |   
        |   ВЫБРАТЬ
        |       Пользователи.Ссылка,
        |       ИСТИНА,
        |       ЛОЖЬ
        |   ИЗ
        |       Справочник.Пользователи КАК Пользователи
        |   ГДЕ
        |       Пользователи.ЭтоГруппа
        |       И Пользователи.Наименование = ""Служебные"") КАК Вложенный
        |
        |СГРУППИРОВАТЬ ПО
        |   Вложенный.Папка
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТПользователиИБ.Имя КАК Имя,
        |   ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |   Пользователи.Ссылка КАК ПользовательСсылка,
        |   МАКСИМУМ(ЕСТЬNULL(Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)), """")) КАК Email,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК Служебный,
        |   ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Администратор КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоАдминистратор1С,
        |   МАКСИМУМ(ЕСТЬNULL(ВЫРАЗИТЬ(ВТПапкиСвойствПользователей.Служебный КАК БУЛЕВО), ЛОЖЬ)) КАК ЭтоСлужебный,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |   ВТПользователиИБ КАК ВТПользователиИБ
        |       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |           ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КонтактнаяИнформация КАК ПользователиКонтактнаяИнформация
        |           ПО (Пользователи.Ссылка = (ВЫРАЗИТЬ(ПользователиКонтактнаяИнформация.Объект КАК Справочник.Пользователи)))
        |               И (ПользователиКонтактнаяИнформация.Тип = ЗНАЧЕНИЕ(Перечисление.ТипыКонтактнойИнформации.АдресЭлектроннойПочты))
        |               И (Выразить(ПользователиКонтактнаяИнформация.Представление КАК Строка(1024)) <> """")
        |           ЛЕВОЕ СОЕДИНЕНИЕ ВТПапкиСвойствПользователей КАК ВТПапкиСвойствПользователей
        |           ПО Пользователи.Родитель = ВТПапкиСвойствПользователей.Папка
        |       ПО ВТПользователиИБ.Имя = Пользователи.Код
        |ГДЕ
        |   НЕ Пользователи.ПометкаУдаления
        |   И (ВТПользователиИБ.АутентификацияСтандартная
        |           ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |           ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |   ВТПользователиИБ.Имя,
        |   ВТПользователиИБ.ПолноеИмя,
        |   ВТПользователиИБ.УникальныйИдентификатор,
        |   ВТПользователиИБ.АдресЭлектроннойПочты,
        |   ВТПользователиИБ.АутентификацияСтандартная,
        |   ВТПользователиИБ.ПарольУстановлен,
        |   ВТПользователиИБ.АутентификацияOpenID,
        |   ВТПользователиИБ.АутентификацияОС,
        |   Пользователи.Ссылка,
        |   ВТПользователиИБ.КолвоСловВИмени,
        |   ВТПользователиИБ.ЕстьПраваАдминистратора,
        |   ВТПользователиИБ.ПоказыватьВСпискеВыбора
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя КАК Имя,
        |   ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |   ""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.АутентификацияСтандартная
        |   И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Не установлен email""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.Email = """"
        |   И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        //|ОБЪЕДИНИТЬ ВСЕ
        //|
        //|ВЫБРАТЬ
        //|   ВТАктивныеПользователи.Имя,
        //|   ВТАктивныеПользователи.ПолноеИмя,
        //|   ВТАктивныеПользователи.ПользовательСсылка,
        //|   ""Имя пользователя отличается от имени пользователя ИБ""
        //|ИЗ
        //|   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        //|ГДЕ
        //|   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        //|   И ВТАктивныеПользователи.ПолноеИмя <> ВТАктивныеПользователи.Имя
        //|
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |   И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |   ВТАктивныеПользователи.Имя,
        |   ВТАктивныеПользователи.ПолноеИмя,
        |   ВТАктивныеПользователи.ПользовательСсылка,
        |   ""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |   ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |   ВТАктивныеПользователи.ЭтоСлужебный
        |   И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |   ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': 'как упп, но другое название ролей'
    },
    {
     'Имя': 'Код1СДляСистемы',
     'Разделитель': 'e1cib/data/Справочник.УМ_ИнформационныеБазы?ref=a14587575112374c11edefe40d317402',
     'ЗначениеСтрока': '    Result = ""; 
    
    СимволПереносаСтроки = Символы.ПС;
    
    ТЗПользователейИБ = Новый ТаблицаЗначений;
    ТЗПользователейИБ.Колонки.Добавить("УникальныйИдентификатор",новый ОписаниеТипов("УникальныйИдентификатор"));
    ТЗПользователейИБ.Колонки.Добавить("Имя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("ПолноеИмя",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АдресЭлектроннойПочты",новый ОписаниеТипов("Строка",,Новый КвалификаторыСтроки(50)));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияСтандартная",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПарольУстановлен",новый ОписаниеТипов("Булево"));   
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияOpenID",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("АутентификацияОС",новый ОписаниеТипов("Булево"));
    ТЗПользователейИБ.Колонки.Добавить("ПоказыватьВСпискеВыбора",новый ОписаниеТипов("Булево"));    
    ТЗПользователейИБ.Колонки.Добавить("КолвоСловВИмени",новый ОписаниеТипов("Число"));            
    ТЗПользователейИБ.Колонки.Добавить("ЕстьПраваАдминистратора",новый ОписаниеТипов("Булево"));
    
        
    МассивАдминскихРолей = Новый Массив;
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("ПолныеПрава"));
    МассивАдминскихРолей.Добавить(Метаданные.Роли.Найти("GodMod"));
    
    ВсеПользователиИБ = ПользователиИнформационнойБазы.ПолучитьПользователей(); 
    Для каждого ПользовательИБ из ВсеПользователиИБ Цикл 
        НовСтрТЗ = ТЗПользователейИБ.Добавить();
        НовСтрТЗ.УникальныйИдентификатор = ПользовательИБ.УникальныйИдентификатор;
        НовСтрТЗ.Имя = ПользовательИБ.Имя;
        НовСтрТЗ.ПолноеИмя = ПользовательИБ.ПолноеИмя;
        НовСтрТЗ.АдресЭлектроннойПочты = ПользовательИБ.АдресЭлектроннойПочты;
        НовСтрТЗ.АутентификацияСтандартная = ПользовательИБ.АутентификацияСтандартная;
        НовСтрТЗ.ПарольУстановлен = ПользовательИБ.ПарольУстановлен;  
        НовСтрТЗ.АутентификацияOpenID = ПользовательИБ.АутентификацияOpenID;
        НовСтрТЗ.АутентификацияОС = ПользовательИБ.АутентификацияОС; 
        НовСтрТЗ.ПоказыватьВСпискеВыбора = ПользовательИБ.ПоказыватьВСпискеВыбора; 
        
        НовСтрТЗ.КолвоСловВИмени = СтрРазделить(НовСтрТЗ.ПолноеИмя," ",Истина).Количество();    
        //проверка админских прав
        ЕстьПраваАдминистратора = Ложь;
        Для каждого АдминскаяРоль Из МассивАдминскихРолей Цикл
            Если ПользовательИБ.Роли.Содержит(АдминскаяРоль) Тогда 
                ЕстьПраваАдминистратора = истина;
                Прервать;
            КонецЕсли;
        КонецЦикла;
        НовСтрТЗ.ЕстьПраваАдминистратора = ЕстьПраваАдминистратора;
    КонецЦикла;
    
    
    Запрос = Новый Запрос;
    Запрос.Текст = 
        "ВЫБРАТЬ
        |	ТЗПользователейИБ.Имя КАК Имя,
        |	ТЗПользователейИБ.ПолноеИмя КАК ПолноеИмя,
        |	ТЗПользователейИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |	ТЗПользователейИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |	ТЗПользователейИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |	ТЗПользователейИБ.ПарольУстановлен КАК ПарольУстановлен,
        |	ТЗПользователейИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |	ТЗПользователейИБ.АутентификацияОС КАК АутентификацияОС,
        |	ТЗПользователейИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора,
        |	ТЗПользователейИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |	ТЗПользователейИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора
        |ПОМЕСТИТЬ ВТПользователиИБ
        |ИЗ
        |	&ТЗПользователейИБ КАК ТЗПользователейИБ
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	ВТПользователиИБ.Имя КАК Имя,
        |	ВТПользователиИБ.ПолноеИмя КАК ПолноеИмя,
        |	ВТПользователиИБ.УникальныйИдентификатор КАК УникальныйИдентификатор,
        |	ВТПользователиИБ.АдресЭлектроннойПочты КАК АдресЭлектроннойПочты,
        |	ВТПользователиИБ.АутентификацияСтандартная КАК АутентификацияСтандартная,
        |	ВТПользователиИБ.ПарольУстановлен КАК ПарольУстановлен,
        |	ВТПользователиИБ.АутентификацияOpenID КАК АутентификацияOpenID,
        |	ВТПользователиИБ.АутентификацияОС КАК АутентификацияОС,
        |	Пользователи.Ссылка КАК ПользовательСсылка,
        |	Пользователи.АдресЭлектроннойПочты КАК Email,
        |	Пользователи.Служебный КАК Служебный,
        |	ВТПользователиИБ.КолвоСловВИмени КАК КолвоСловВИмени,
        |	ВТПользователиИБ.ЕстьПраваАдминистратора КАК ЕстьПраваАдминистратора,
        |	Пользователи.Администратор1С КАК ЭтоАдминистратор1С,
        |	Пользователи.Служебный КАК ЭтоСлужебный,
        |	ВТПользователиИБ.ПоказыватьВСпискеВыбора КАК ПоказыватьВСпискеВыбора
        |ПОМЕСТИТЬ ВТАктивныеПользователи
        |ИЗ
        |	ВТПользователиИБ КАК ВТПользователиИБ
        |		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Пользователи КАК Пользователи
        |		ПО ВТПользователиИБ.УникальныйИдентификатор = Пользователи.ИдентификаторПользователяИБ
        |ГДЕ
        |	(ВТПользователиИБ.АутентификацияСтандартная
        |			ИЛИ ВТПользователиИБ.АутентификацияOpenID
        |			ИЛИ ВТПользователиИБ.АутентификацияОС)
        |
        |СГРУППИРОВАТЬ ПО
        |	ВТПользователиИБ.Имя,
        |	ВТПользователиИБ.ПолноеИмя,
        |	ВТПользователиИБ.УникальныйИдентификатор,
        |	ВТПользователиИБ.АдресЭлектроннойПочты,
        |	ВТПользователиИБ.АутентификацияСтандартная,
        |	ВТПользователиИБ.ПарольУстановлен,
        |	ВТПользователиИБ.АутентификацияOpenID,
        |	ВТПользователиИБ.АутентификацияОС,
        |	Пользователи.Ссылка,
        |	Пользователи.Служебный,
        |	ВТПользователиИБ.КолвоСловВИмени,
        |	ВТПользователиИБ.ЕстьПраваАдминистратора,
        |	ВТПользователиИБ.ПоказыватьВСпискеВыбора,
        |	Пользователи.АдресЭлектроннойПочты,
        |	Пользователи.Администратор1С,
        |	Пользователи.Служебный
        |;
        |
        |////////////////////////////////////////////////////////////////////////////////
        |ВЫБРАТЬ
        |	ВТАктивныеПользователи.Имя КАК Имя,
        |	ВТАктивныеПользователи.ПолноеИмя КАК ПолноеИмя,
        |	ВТАктивныеПользователи.ПользовательСсылка КАК ПользовательСсылка,
        |	""Пустой пароль 1С"" КАК Нарушение
        |ИЗ
        |	ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |	ВТАктивныеПользователи.АутентификацияСтандартная
        |	И НЕ ВТАктивныеПользователи.ПарольУстановлен
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |	ВТАктивныеПользователи.Имя,
        |	ВТАктивныеПользователи.ПолноеИмя,
        |	ВТАктивныеПользователи.ПользовательСсылка,
        |	""Не установлен email""
        |ИЗ
        |	ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |	ВТАктивныеПользователи.Email = """"
        |	И НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |	ВТАктивныеПользователи.Имя,
        |	ВТАктивныеПользователи.ПолноеИмя,
        |	ВТАктивныеПользователи.ПользовательСсылка,
        |	""Имя должно состоять из 3 слов: ФИО""
        |ИЗ
        |	ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |	НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |	И ВТАктивныеПользователи.КолвоСловВИмени <> 3
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |	ВТАктивныеПользователи.Имя,
        |	ВТАктивныеПользователи.ПолноеИмя,
        |	ВТАктивныеПользователи.ПользовательСсылка,
        |	""Пользователь (не администратор 1С) имеет админские права""
        |ИЗ
        |	ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |	НЕ ВТАктивныеПользователи.ЭтоСлужебный
        |	И ВТАктивныеПользователи.ЕстьПраваАдминистратора
        |	И НЕ ВТАктивныеПользователи.ЭтоАдминистратор1С
        |
        |ОБЪЕДИНИТЬ ВСЕ
        |
        |ВЫБРАТЬ
        |	ВТАктивныеПользователи.Имя,
        |	ВТАктивныеПользователи.ПолноеИмя,
        |	ВТАктивныеПользователи.ПользовательСсылка,
        |	""Слежубный пользователь не должен быть показан в списке выбора""
        |ИЗ
        |	ВТАктивныеПользователи КАК ВТАктивныеПользователи
        |ГДЕ
        |	ВТАктивныеПользователи.ЭтоСлужебный
        |	И ВТАктивныеПользователи.ПоказыватьВСпискеВыбора
        |
        |УПОРЯДОЧИТЬ ПО
        |	ПолноеИмя"; 
    
    Запрос.УстановитьПараметр("ТЗПользователейИБ",ТЗПользователейИБ);

    Выборка = Запрос.Выполнить().Выбрать();
    ПП=0;
    Пока Выборка.Следующий() Цикл
        ПП=ПП+1;
        НавСсылка = ПолучитьНавигационнуюСсылку(Выборка.ПользовательСсылка);
        Result = Result
            + ПП +"."+ Символы.ТАБ  
            + Выборка.ПолноеИмя + Символы.ТАБ
            + Выборка.Нарушение + Символы.ТАБ
            + НавСсылка + СимволПереносаСтроки;
    КонецЦикла;',
     'Комментарий': ''
    }
   ]
  }
 ]
}
