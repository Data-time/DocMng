{
 'Реквизиты': {
  'Код': 'ОтправитьEmail',
  'Наименование': 'ОтправитьEmail',
  'Принадлежит': 'e1cib/data/Справочник.УМ_Запрос?ref=00000000000000000000000000000000',
  'ТекстАлгоритма': 'ПараметрыПисьма = Новый Структура;   
	
	Кому = Новый Массив;
	ТекМассив = ОбщегоНазначенияКлиентСервер.АдресаЭлектроннойПочтыИзСтроки(ПочтаПолучателей);
	Для каждого ТекПочта Из ТекМассив Цикл
		Кому.Добавить(Новый Структура("Адрес, Представление", ТекПочта.Адрес, ТекПочта.Псевдоним));
	КонецЦикла;
	ПараметрыПисьма.Вставить("Кому", Кому);
	
	Если ЗначениеЗаполнено(ПолучателиКопия) Тогда
		Копии = Новый Массив;
		ТекМассив = ОбщегоНазначенияКлиентСервер.АдресаЭлектроннойПочтыИзСтроки(ПолучателиКопия);
		Для каждого ТекПочта Из ТекМассив Цикл
			Копии.Добавить(Новый Структура("Адрес, Представление", ТекПочта.Адрес, ТекПочта.Псевдоним));
		КонецЦикла;
		ПараметрыПисьма.Вставить("Копии", Копии);
	КонецЕсли;

	Если ЗначениеЗаполнено(ПолучателиСкрытаяКопия) Тогда
		СкрытыеКопии = Новый Массив;
		ТекМассив = ОбщегоНазначенияКлиентСервер.АдресаЭлектроннойПочтыИзСтроки(ПолучателиСкрытаяКопия);
		Для каждого ТекПочта Из ТекМассив Цикл
			СкрытыеКопии.Добавить(Новый Структура("Адрес, Представление", ТекПочта.Адрес, ТекПочта.Псевдоним));
		КонецЦикла;
		ПараметрыПисьма.Вставить("СкрытыеКопии", СкрытыеКопии);
	КонецЕсли;
	
	ПараметрыПисьма.Вставить("Тема", ТемаСообщения);
	ПараметрыПисьма.Вставить("Тело", ТекстСообщения);

	Если Вложения <> Неопределено Тогда
		ПараметрыПисьма.Вставить("Вложения",Вложения);
	КонецЕсли;

	Если ТипТекста = Неопределено Тогда
		ТипТекста = ТипТекстаПочтовогоСообщения.РазмеченныйТекст;
	КонецЕсли; 
	ПараметрыПисьма.Вставить("ТипТекста",ТипТекста);
	
	//отправка 
	Если ГуидУчетнойЗаписиПочты = Неопределено Тогда
		УчетнаяЗапись = Справочники.УчетныеЗаписиЭлектроннойПочты.СистемнаяУчетнаяЗаписьЭлектроннойПочты;
	Иначе
		УчетнаяЗапись = Справочники.УчетныеЗаписиЭлектроннойПочты.ПолучитьСсылку(Новый УникальныйИдентификатор(ГуидУчетнойЗаписиПочты));
	КонецЕсли;
	
	Письмо = РаботаСПочтовымиСообщениями.ПодготовитьПисьмо(УчетнаяЗапись, ПараметрыПисьма);
	РезультатОтправки = РаботаСПочтовымиСообщениями.ОтправитьПисьмо(УчетнаяЗапись, Письмо);
	
	ЗаписьЖурналаРегистрации("УМ_ОтправкаПисем",УровеньЖурналаРегистрации.Информация,,ЗапросСсылка,"Отправлено письмо "+ТемаСообщения);
	
	//ошибки отправки
	Для каждого КлючИЗначениеСоответствия из РезультатОтправки.ОшибочныеПолучатели Цикл
		АдресПолучателя = КлючИЗначениеСоответствия.Ключ;
		ТекстОшибки = ""+КлючИЗначениеСоответствия.Значение;
		ЗаписьЖурналаРегистрации("УМ_ОтправкаПисем",УровеньЖурналаРегистрации.Ошибка,,ЗапросСсылка,""+АдресПолучателя+" - "+ТекстОшибки);
	КонецЦикла;',
  'Описание': ''
 },
 'ТЧ': [
  {
   'Параметры': [
    {
     'ИмяПараметра': 'ЗапросСсылка'
    },
    {
     'ИмяПараметра': 'ПочтаПолучателей'
    },
    {
     'ИмяПараметра': 'ТемаСообщения'
    },
    {
     'ИмяПараметра': 'ТекстСообщения'
    },
    {
     'ИмяПараметра': 'ТипТекста'
    },
    {
     'ИмяПараметра': 'ГуидУчетнойЗаписиПочты'
    },
    {
     'ИмяПараметра': 'Вложения'
    },
    {
     'ИмяПараметра': 'ПолучателиКопия'
    },
    {
     'ИмяПараметра': 'ПолучателиСкрытаяКопия'
    }
   ]
  }
 ]
}
